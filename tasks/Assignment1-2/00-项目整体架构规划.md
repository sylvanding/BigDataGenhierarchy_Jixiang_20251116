# 项目整体架构规划

## 一、项目概述

本项目基于度量空间理论，使用Java语言实现通用的度量空间数据管理与分析系统。项目分为两个阶段：

- **Assignment 1**: 实现基本的度量空间数据处理系统
- **Assignment 2**: 在Assignment 1基础上实现相似性查询功能

## 二、代码仓库整体架构

### 2.1 目录结构

```
BigDataGenhierarchy_Jixiang_20251116/
├── src/
│   ├── main/
│   │   └── java/
│   │       ├── core/                         # 核心抽象类
│   │       │   ├── MetricSpaceData.java      # 度量空间数据抽象父类
│   │       │   └── MetricFunction.java       # 距离函数抽象父类
│   │       ├── datatype/                     # 具体数据类型实现
│   │       │   ├── vector/
│   │       │   │   ├── VectorData.java        # 向量数据类型
│   │       │   │   └── MinkowskiDistance.java # 闵可夫斯基距离
│   │       │   └── protein/
│   │       │       ├── ProteinData.java       # 蛋白质序列类型
│   │       │       └── AlignmentDistance.java # Alignment距离
│   │       ├── io/                      # 数据读取模块
│   │       │   ├── DataReader.java           # 数据读取接口
│   │       │   ├── VectorDataReader.java     # 向量数据读取器
│   │       │   └── ProteinDataReader.java    # 蛋白质数据读取器
│   │       ├── query/                   # 查询模块 (Assignment 2)
│   │       │   ├── LinearScan.java           # 线性扫描查询
│   │       │   ├── RangeQuery.java           # 范围查询
│   │       │   ├── KNNQuery.java             # k近邻查询
│   │       │   └── DKNNQuery.java            # 多样化k近邻查询
│   │       └── index/                   # 索引模块 (Assignment 2)
│   │           ├── PivotTable.java          # Pivot Table索引
│   │           └── PivotSelection.java      # 支撑点选择算法
│   └── test/
│       └── java/
│           ├── datatype/
│           │   ├── VectorDataTest.java
│           │   └── ProteinDataTest.java
│           ├── query/
│           │   ├── RangeQueryTest.java
│           │   ├── KNNQueryTest.java
│           │   └── DKNNQueryTest.java
│           └── index/
│               └── PivotTableTest.java
├── data/                          # 数据集目录
│   ├── vector/
│   │   └── (从UMAD-Dataset复制相关数据)
│   └── protein/
│       └── (从UMAD-Dataset复制相关数据)
├── Assignment1/
│   ├── Assignment1-Requirements.md
│   └── lab-report-1/              # Assignment 1 实验报告
│       └── main.tex
├── Assignment2/
│   ├── Assignment2-Requirements.md
│   └── lab-report-2/              # Assignment 2 实验报告
│       └── main.tex
├── docs/                          # 文档目录（已存在）
├── tasks/                         # 任务计划目录
└── pom.xml                        # Maven配置文件
```

### 2.2 核心设计原则

1. **抽象优先**: 先设计抽象父类，再实现具体子类
2. **接口分离**: 数据类型和距离函数分离设计
3. **可扩展性**: 便于后续添加新的数据类型和距离函数
4. **测试驱动**: 每个功能模块都有对应的测试用例
5. **文档完善**: 代码注释清晰，实验报告详尽

### 2.3 技术栈

- **编程语言**: Java 12
- **构建工具**: Maven
- **测试框架**: JUnit 4.13.2
- **文档工具**: LaTeX (实验报告)
- **数据集**: UMAD (Universal Management and Analysis of Data)

## 三、与原始代码的对应关系

### 3.1 核心抽象类对应

- `MetricSpaceData.java` ← `UMAD-OriginalCode/src/main/java/db/type/IndexObject.java`
- `MetricFunction.java` ← `UMAD-OriginalCode/src/main/java/metric/Metric.java`

### 3.2 数据类型对应

- `VectorData.java` ← `UMAD-OriginalCode/src/main/java/db/type/DoubleVector.java`
- `ProteinData.java` ← `UMAD-OriginalCode/src/main/java/db/type/Peptide.java`

### 3.3 距离函数对应

- `MinkowskiDistance.java` ← `UMAD-OriginalCode/src/main/java/metric/LMetric.java`
- `AlignmentDistance.java` ← `UMAD-OriginalCode/src/main/java/metric/SequenceFragmentMetric.java` 和 mPAM矩阵

### 3.4 查询模块对应

- `RangeQuery.java` ← `UMAD-OriginalCode/src/main/java/index/search/RangeQuery.java`
- `KNNQuery.java` ← `UMAD-OriginalCode/src/main/java/index/search/KNNQuery.java`

### 3.5 索引模块对应

- `PivotTable.java` ← `UMAD-OriginalCode/src/main/java/index/structure/PivotTable.java`

## 四、理论基础对应

### 4.1 度量空间基本概念

- **来源**: full.md 第1章 - 大数据泛构的基本概念
- **内容**: 通用数据管理分析模式、度量空间特性（三角不等性、非负性、对称性）

### 4.2 常见度量空间实例

- **来源**: full.md 第2章 - 常见的度量空间实例
- **内容**: 向量空间的闵可夫斯基距离、序列空间的编辑距离

### 4.3 相似性查询

- **来源**: full.md 第3章 - 度量空间索引概述 (3.1节和3.2节)
- **内容**:
  - 范围查询 (Range Query)
  - k近邻查询 (k-Nearest Neighbor Query, kNN)
  - 多样化k近邻查询 (Diversified kNN, dkNN)

### 4.4 Pivot Table索引

- **来源**: full.md 第3.3节 - 支撑点表（Pivot Table）
- **内容**:
  - Pivot Table的结构和构建 (3.3.1节)
  - Pivot Table的范围查询 (3.3.2节)
  - 三角不等式的应用（排除规则和包含规则）

### 4.5 支撑点选择

- **来源**: full.md 第5章 - 支撑点选择
- **内容**:
  - 支撑点选择的必要性
  - 支撑点个数的确定
  - 支撑点选择算法（如FFT, CENTER, RANDOM等）

### 4.6 数据集说明

- **来源**: 1.2 数据集介绍.md
- **内容**:
  - Vector数据集格式和使用方法 (1.2.1节)
  - Protein数据集格式和使用方法 (1.2.5节)
  - mPAM替代矩阵

## 五、开发流程

### 5.1 Assignment 1 开发流程

1. 环境搭建和项目初始化
2. 实现核心抽象类
3. 实现向量数据类型和闵可夫斯基距离
4. 实现蛋白质序列类型和Alignment距离
5. 编写测试用例
6. 撰写实验报告

### 5.2 Assignment 2 开发流程

1. 实现线性扫描查询（范围查询、kNN、dkNN）
2. 实现Pivot Table索引
3. 编写功能正确性测试
4. 进行性能分析实验
5. 撰写实验报告

## 六、交付物清单

### 6.1 Assignment 1 交付物

- [ ] 完整的源代码（符合上述架构）
- [ ] 测试代码和测试结果
- [ ] 实验报告PDF（LaTeX编译）
- [ ] 代码运行说明文档

### 6.2 Assignment 2 交付物

- [ ] 完整的源代码（在Assignment 1基础上扩展）
- [ ] 查询功能测试代码和结果
- [ ] 性能分析实验数据和图表
- [ ] 实验报告PDF（LaTeX编译）
- [ ] 代码运行说明文档

## 七、质量保证

### 7.1 代码质量

- 遵循Java编码规范
- 类和方法都有完整的JavaDoc注释
- 合理的异常处理
- 日志输出清晰

### 7.2 测试质量

- 每个数据类型至少3个代表性测试
- 每个查询功能至少3个代表性测试
- 测试用例设计要易于验证（显示计算过程）

### 7.3 报告质量

- 结构完整，符合要求文档的大纲
- 图文并茂，代码展示清晰
- 理论分析透彻
- 实验数据真实可靠

## 八、时间规划建议

### 8.1 Assignment 1

- 第1周: 环境搭建、架构设计、核心抽象类
- 第2周: 向量数据类型和测试
- 第3周: 蛋白质序列类型和测试
- 第4周: 完善测试、撰写报告
- 第5周: 报告完善、代码优化

### 8.2 Assignment 2

- 第1周: 线性扫描查询实现和测试
- 第2周: Pivot Table索引实现和测试
- 第3周: 性能分析实验设计和执行
- 第4周: 数据分析、图表制作
- 第5周: 撰写报告、代码优化

## 九、注意事项

1. **代码复用**: 充分学习和借鉴UMAD-OriginalCode的设计思想，但不要直接复制粘贴，要理解后重新实现
2. **测试先行**: 在实现功能前先设计测试用例，确保测试的全面性
3. **增量开发**: 每完成一个模块就进行测试，不要等到全部完成再测试
4. **版本控制**: 使用Git进行版本控制，重要节点要打tag
5. **文档同步**: 代码实现的同时就要完善文档，不要等到最后才写文档
