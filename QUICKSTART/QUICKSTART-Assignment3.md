# Assignment 3 快速开始指南

本指南帮助你快速运行和测试Assignment 3的GH树和VP树索引实现。

## 目录

- [快速测试步骤](#快速测试步骤)
- [演示程序说明](#演示程序说明)
- [代码结构说明](#代码结构说明)
- [理论背景](#理论背景)
- [常见问题](#常见问题)

---

## 快速测试步骤

### 第一步：编译项目

```bash
cd BigDataGenhierarchy_Jixiang_20251116
mvn clean compile
```

### 第二步：运行GH树和VP树功能演示

```bash
mvn exec:java "-Dexec.mainClass=examples.assignment3.TreeDemo"
```

**你会看到**：

- ✅ GH树构建过程展示
- ✅ VP树构建过程展示
- ✅ 树结构可视化
- ✅ 范围查询结果验证
- ✅ kNN查询结果验证
- ✅ 与线性扫描结果一致性检验

### 第三步：运行性能对比分析

```bash
mvn exec:java "-Dexec.mainClass=examples.assignment3.TreePerformanceAnalysis"
```

**你会看到**：

- ✅ 不同数据集上的性能对比
- ✅ 构建时间对比
- ✅ 查询性能对比
- ✅ 剪枝率分析
- ✅ 参数影响分析

---

## 演示程序说明

### TreeDemo.java - 功能演示

该程序展示GH树和VP树的核心功能：

#### 1. 小规模数据演示（便于手工验证）

程序首先使用15个2D点进行演示，输出详细的构建过程：

```
【1. 测试数据集】
--------------------------------------------------
数据类型: 2维向量
距离函数: 欧几里得距离 (L2)
数据数量: 15

数据点列表:
  ID=0: (1.0, 1.0)
  ID=1: (2.0, 2.0)
  ID=2: (3.0, 1.0)
  ID=3: (4.0, 4.0)
  ID=4: (5.0, 2.0)
  ID=5: (6.0, 5.0)
  ID=6: (7.0, 3.0)
  ID=7: (8.0, 6.0)
  ID=8: (9.0, 4.0)
  ID=9: (10.0, 7.0)
  ID=10: (3.0, 5.0)
  ID=11: (6.0, 1.0)
  ID=12: (2.0, 7.0)
  ID=13: (8.0, 2.0)
  ID=14: (4.0, 8.0)
```

#### 2. GH树构建演示

展示超平面划分的过程：

```
【2. GH树构建演示】
--------------------------------------------------

============================================================
开始构建 GH-Tree (超平面树)
============================================================
数据集大小: 15
配置: TreeConfig[maxLeafSize=3, minTreeHeight=2, pivotStrategy=FFT, verbose=true, seed=42]
  深度0: 选择支撑点 p1=VectorData[id=5, dim=2, coords=[6.0000, 5.0000]], p2=VectorData[id=0, dim=2, coords=[1.0000, 1.0000]]
  深度0: 数据划分完成，左=12，右=3
  深度1: 选择支撑点 p1=VectorData[id=6, dim=2, coords=[7.0000, 3.0000]], p2=VectorData[id=12, dim=2, coords=[2.0000, 7.0000]]
  深度1: 数据划分完成，左=9，右=3
  深度2: 选择支撑点 p1=VectorData[id=3, dim=2, coords=[4.0000, 4.0000]], p2=VectorData[id=9, dim=2, coords=[10.0000, 7.0000]]
  深度2: 数据划分完成，左=6，右=3
  深度3: 选择支撑点 p1=VectorData[id=5, dim=2, coords=[6.0000, 5.0000]], p2=VectorData[id=11, dim=2, coords=[6.0000, 1.0000]]
  深度3: 数据划分完成，左=2，右=4
  深度4: 创建叶子节点，数据量=2
  深度4: 选择支撑点 p1=VectorData[id=6, dim=2, coords=[7.0000, 3.0000]], p2=VectorData[id=4, dim=2, coords=[5.0000, 2.0000]]
  深度4: 数据划分完成，左=2，右=2
  深度5: 创建叶子节点，数据量=2
  深度5: 创建叶子节点，数据量=2
  深度3: 创建叶子节点，数据量=3
  深度2: 创建叶子节点，数据量=3
  深度1: 选择支撑点 p1=VectorData[id=1, dim=2, coords=[2.0000, 2.0000]], p2=VectorData[id=0, dim=2, coords=[1.0000, 1.0000]]
  深度1: 数据划分完成，左=2，右=1
  深度2: 创建叶子节点，数据量=2
  深度2: 创建叶子节点，数据量=1

构建完成!
----------------------------------------
构建耗时: 10 ms
树高度: 5
总节点数: 13
  - 内部节点: 6
  - 叶子节点: 7
构建距离计算次数: 147
============================================================

GH树结构:

GH-Tree (超平面树) 树结构:
--------------------------------------------------
└── GH内部节点 [左=12, 右=3, p1=ID5, p2=ID0]
    ├── GH内部节点 [左=9, 右=3, p1=ID6, p2=ID12]
    │   ├── GH内部节点 [左=6, 右=3, p1=ID3, p2=ID9]
    │   │   ├── GH内部节点 [左=2, 右=4, p1=ID5, p2=ID11]
    │   │   │   ├── 叶子节点 [数据量=2]
    │   │   │   └── GH内部节点 [左=2, 右=2, p1=ID6, p2=ID4]
    │   │   │       ├── 叶子节点 [数据量=2]
    │   │   │       └── 叶子节点 [数据量=2]
    │   │   └── 叶子节点 [数据量=3]
    │   └── 叶子节点 [数据量=3]
    └── GH内部节点 [左=2, 右=1, p1=ID1, p2=ID0]
        ├── 叶子节点 [数据量=2]
        └── 叶子节点 [数据量=1]
```

#### 3. VP树构建演示

展示球形划分的过程：

```
【3. VP树构建演示】
--------------------------------------------------

============================================================
开始构建 VP-Tree (优势点树)
============================================================
数据集大小: 15
配置: TreeConfig[maxLeafSize=3, minTreeHeight=2, pivotStrategy=FFT, verbose=true, seed=42]
  深度0: 选择支撑点 VectorData[id=0, dim=2, coords=[1.0000, 1.0000]]
  深度0: 数据划分完成，内球=7[1.4142, 6.0828]，外球=7[6.3246, 10.8167]，中位数=6.2037
  深度1: 选择支撑点 VectorData[id=11, dim=2, coords=[6.0000, 1.0000]]
  深度1: 数据划分完成，内球=3[1.4142, 3.6056]，外球=3[4.1231, 7.2111]，中位数=3.8643
  深度2: 创建叶子节点，数据量=3
  深度2: 创建叶子节点，数据量=3
  深度1: 选择支撑点 VectorData[id=14, dim=2, coords=[4.0000, 8.0000]]
  深度1: 数据划分完成，内球=3[3.6056, 5.8310]，外球=3[6.0828, 7.2111]，中位数=5.9569
  深度2: 创建叶子节点，数据量=3
  深度2: 创建叶子节点，数据量=3

构建完成!
----------------------------------------
构建耗时: 6 ms
树高度: 2
总节点数: 7
  - 内部节点: 3
  - 叶子节点: 4
构建距离计算次数: 55
============================================================

VP树结构:

VP-Tree (优势点树) 树结构:
--------------------------------------------------
└── VP内部节点 [内=7, 外=7, median=6.204, pivot=ID0]
    ├── VP内部节点 [内=3, 外=3, median=3.864, pivot=ID11]
    │   ├── 叶子节点 [数据量=3]
    │   └── 叶子节点 [数据量=3]
    └── VP内部节点 [内=3, 外=3, median=5.957, pivot=ID14]
        ├── 叶子节点 [数据量=3]
        └── 叶子节点 [数据量=3]
```

#### 4. 范围查询验证

验证查询结果的正确性：

```
【4. 范围查询演示】
--------------------------------------------------
查询点: (5.0, 5.0)
查询半径: 3.0

--- 线性扫描结果（基准） ---
结果数量: 5
距离计算次数: 15
结果详情:
  ID=5: (6.0, 5.0), 距离=1.0000
  ID=3: (4.0, 4.0), 距离=1.4142
  ID=10: (3.0, 5.0), 距离=2.0000
  ID=6: (7.0, 3.0), 距离=2.8284
  ID=4: (5.0, 2.0), 距离=3.0000

--- GH树范围查询 ---

--------------------------------------------------
GH树范围查询
--------------------------------------------------
查询对象: VectorData[id=100, dim=2, coords=[5.0000, 5.0000]]
查询半径: 3.0
查询结果数量: 5
距离计算次数: 27
节点访问次数: 13
--------------------------------------------------
结果数量: 5
距离计算次数: 27
节点访问次数: 13
结果详情:
  ID=5: (6.0, 5.0), 距离=1.0000
  ID=3: (4.0, 4.0), 距离=1.4142
  ID=10: (3.0, 5.0), 距离=2.0000
  ID=6: (7.0, 3.0), 距离=2.8284
  ID=4: (5.0, 2.0), 距离=3.0000

--- VP树范围查询 ---

--------------------------------------------------
VP树范围查询
--------------------------------------------------
查询对象: VectorData[id=100, dim=2, coords=[5.0000, 5.0000]]
查询半径: 3.0
查询结果数量: 5
距离计算次数: 15
节点访问次数: 7
--------------------------------------------------
结果数量: 5
距离计算次数: 15
节点访问次数: 7
结果详情:
  ID=5: (6.0, 5.0), 距离=1.0000
  ID=3: (4.0, 4.0), 距离=1.4142
  ID=10: (3.0, 5.0), 距离=2.0000
  ID=6: (7.0, 3.0), 距离=2.8284
  ID=4: (5.0, 2.0), 距离=3.0000

--- 结果一致性验证 ---
GH树结果与线性扫描一致: ✓
VP树结果与线性扫描一致: ✓
```

#### 5. kNN查询验证

```
【5. kNN查询演示】
--------------------------------------------------
查询点: (5.0, 5.0)
k = 3

--- GH树kNN查询 ---

--------------------------------------------------
GH树kNN查询
--------------------------------------------------
查询对象: VectorData[id=100, dim=2, coords=[5.0000, 5.0000]]
k = 3
查询结果数量: 3
距离计算次数: 22
节点访问次数: 10
--------------------------------------------------
距离计算次数: 22
节点访问次数: 10
前3个最近邻:
  #1: ID=5 (6.0, 5.0), 距离=1.0000
  #2: ID=3 (4.0, 4.0), 距离=1.4142
  #3: ID=10 (3.0, 5.0), 距离=2.0000

--- VP树kNN查询 ---

--------------------------------------------------
VP树kNN查询
--------------------------------------------------
查询对象: VectorData[id=100, dim=2, coords=[5.0000, 5.0000]]
k = 3
查询结果数量: 3
距离计算次数: 12
节点访问次数: 6
--------------------------------------------------
距离计算次数: 12
节点访问次数: 6
前3个最近邻:
  #1: ID=5 (6.0, 5.0), 距离=1.0000
  #2: ID=3 (4.0, 4.0), 距离=1.4142
  #3: ID=10 (3.0, 5.0), 距离=2.0000
```

#### 6. 使用文件数据演示

```
======================================================================
第二部分：使用文件数据演示
======================================================================

【1. 加载数据】
--------------------------------------------------
数据集信息：
  文件路径: UMAD-Dataset/examples/Vector/test_vectors_2d.txt
  向量维度: 2
  数据总量: 5
  读取数量: 5
成功读取 5 个向量


【2. 构建GH树】
--------------------------------------------------
构建时间: 1 ms
树高度: 2
总节点数: 5
叶子节点数: 3
构建距离计算: 24

【3. 构建VP树】
--------------------------------------------------
构建时间: 0 ms
树高度: 1
总节点数: 3
叶子节点数: 2
构建距离计算: 9

【4. 范围查询性能对比】
--------------------------------------------------
查询点: VectorData[id=0, dim=2, coords=[0.0000, 0.0000]]

半径         | 线性扫描         | GH树          | VP树          | GH剪枝率        | VP剪枝率       
--------------------------------------------------------------------------------
0.5        | 5            | 7            | 3            | -40.0      % | 40.0       %
1.0        | 5            | 7            | 5            | -40.0      % | 0.0        %
2.0        | 5            | 7            | 5            | -40.0      % | 0.0        %

【5. kNN查询性能对比】
--------------------------------------------------
2.0        | 5            | 7            | 5            | -40.0      % | 0.0        %
2.0        | 5            | 7            | 5            | -40.0      % | 0.0        %

【5. kNN查询性能对比】
--------------------------------------------------
查询点: VectorData[id=0, dim=2, coords=[0.0000, 0.0000]]
查询点: VectorData[id=0, dim=2, coords=[0.0000, 0.0000]]

k      | 线性扫描         | GH树          | VP树          | GH剪枝率
-----------------------------------------------------------------
5      | 5            | 9            | 5            | -80.0      %
10     | 5            | 9            | 5            | -80.0      %
20     | 5            | 9            | 5            | -80.0      %

======================================================================
演示完成！
======================================================================
```

### TreePerformanceAnalysis.java - 性能分析

该程序进行全面的性能对比分析：

#### 实验1: 低维向量数据集 (2维)

```
================================================================================
实验1: 低维向量数据集 (2维)
================================================================================

数据集: 聚类2D向量
数据量: 10000
维度: 2

【构建性能】
------------------------------------------------------------
索引类型            | 构建时间(ms)     | 距离计算         | 树高         | 节点数       
-----------------------------------------------------------------
GH-Tree         | 33           | 290202       | 15         | 679
VP-Tree         | 50           | 92248        | 8          | 511

【范围查询性能】
------------------------------------------------------------
半径         | 线性扫描         | GH-Tree      | VP-Tree      | GH剪枝率      | VP剪枝率     
---------------------------------------------------------------------------
50.0       | 100000       | 106780       | 100000       | -6.8     % | 0.0      %
100.0      | 100000       | 106780       | 100000       | -6.8     % | 0.0      %
200.0      | 100000       | 106780       | 100000       | -6.8     % | 0.0      %

【kNN查询性能】
------------------------------------------------------------
k      | 线性扫描         | GH-Tree      | VP-Tree      | GH剪枝率      | VP剪枝率
----------------------------------------------------------------------
5      | 100000       | 1040         | 811          | 99.0     % | 99.2     %
10     | 100000       | 1410         | 967          | 98.6     % | 99.0     %
20     | 100000       | 1772         | 1439         | 98.2     % | 98.6     %
```

#### 实验2: 高维向量数据集 (10-20维)

```
================================================================================
实验2: 高维向量数据集 (20维)
================================================================================

数据集: 均匀20D向量
数据量: 5000
维度: 20

【构建性能】
------------------------------------------------------------
索引类型            | 构建时间(ms)     | 距离计算         | 树高         | 节点数       
-----------------------------------------------------------------
GH-Tree         | 21           | 128412       | 15         | 329
VP-Tree         | 26           | 41103        | 7          | 255

【范围查询性能】
------------------------------------------------------------
半径         | 线性扫描         | GH-Tree      | VP-Tree      | GH剪枝率      | VP剪枝率
---------------------------------------------------------------------------
2.0        | 50000        | 53280        | 50000        | -6.6     % | 0.0      %
3.0        | 50000        | 53280        | 50000        | -6.6     % | 0.0      %
4.0        | 50000        | 53280        | 50000        | -6.6     % | 0.0      %

【kNN查询性能】
------------------------------------------------------------
k      | 线性扫描         | GH-Tree      | VP-Tree      | GH剪枝率      | VP剪枝率
----------------------------------------------------------------------
5      | 50000        | 53280        | 50000        | -6.6     % | 0.0      %
10     | 50000        | 53280        | 50000        | -6.6     % | 0.0      %
20     | 50000        | 53280        | 50000        | -6.6     % | 0.0      %
```

#### 实验3: 蛋白质序列数据集

```
================================================================================
实验3: 蛋白质序列数据集
================================================================================
数据集信息：
  文件路径: UMAD-Dataset/full/Protein/unzipped/yeast.txt
  片段长度: 6
成功读取 5 个序列
生成 1469 个数据对象


数据集: 酵母蛋白质序列
数据量: 1469
序列长度: 6

【构建性能】
------------------------------------------------------------
索引类型            | 构建时间(ms)     | 距离计算         | 树高         | 节点数       
-----------------------------------------------------------------
GH-Tree         | 33           | 28461        | 8          | 149
VP-Tree         | 10           | 11682        | 6          | 127

【范围查询性能】
------------------------------------------------------------
半径         | 线性扫描         | GH-Tree      | VP-Tree      | GH剪枝率      | VP剪枝率
---------------------------------------------------------------------------
1.0        | 7345         | 3106         | 2076         | 57.7     % | 71.7     %
2.0        | 7345         | 6798         | 5794         | 7.4      % | 21.1     %
3.0        | 7345         | 7229         | 6604         | 1.6      % | 10.1     %
```

#### 实验4: 参数影响分析

```
================================================================================
实验4: 参数影响分析
================================================================================

【4.1 最大叶子节点大小的影响】
------------------------------------------------------------
叶子大小         | GH树高       | VP树高       | GH距离计算       | VP距离计算
----------------------------------------------------------------------
10           | 17         | 9          | 641          | 294
25           | 14         | 7          | 532          | 306
50           | 11         | 6          | 833          | 1006        
100          | 10         | 5          | 481          | 948
200          | 7          | 4          | 821          | 1881        

【4.2 Pivot选择策略的影响】
------------------------------------------------------------
策略              | GH构建距离       | VP构建距离       | GH查询距离       | VP查询距离
---------------------------------------------------------------------------
RANDOM          | 42844        | 17880        | 1555         | 667
FFT             | 71316        | 21030        | 833          | 1006        
MAX_SPREAD      | 146293       | 21030        | 593          | 1006
```

---

## 代码结构说明

### 新增的核心类

```
src/main/java/
├── index/
│   ├── Index.java                    # 索引接口（新增）
│   └── tree/                         # 树索引模块（新增）
│       ├── TreeNode.java             # 树节点接口
│       ├── InternalNode.java         # 内部节点抽象类
│       ├── LeafNode.java             # 叶子节点类
│       ├── TreeIndex.java            # 树索引抽象基类
│       ├── common/
│       │   ├── TreeConfig.java       # 树配置类
│       │   └── TreeHeightController.java # 树高控制器
│       ├── ghtree/
│       │   ├── GHTree.java           # GH树实现
│       │   └── GHInternalNode.java   # GH树内部节点
│       └── vptree/
│           ├── VPTree.java           # VP树实现
│           └── VPInternalNode.java   # VP树内部节点
└── examples/
    └── assignment3/
        ├── TreeDemo.java             # 功能演示程序
        └── TreePerformanceAnalysis.java # 性能分析程序
```

### 主要类说明

| 类名 | 功能 |
|------|------|
| `Index` | 所有索引结构的统一接口 |
| `TreeIndex` | 树索引的抽象基类，提供公共方法 |
| `GHTree` | GH树实现，使用超平面划分 |
| `VPTree` | VP树实现，使用球形划分 |
| `TreeConfig` | 树的配置参数，支持Builder模式 |
| `TreeHeightController` | 控制树的最小高度 |

### 使用示例

```java
// 配置树参数
TreeConfig config = new TreeConfig.Builder()
        .maxLeafSize(50)           // 最大叶子节点容量
        .minTreeHeight(3)          // 最小树高
        .pivotStrategy(TreeConfig.PivotSelectionStrategy.FFT)  // FFT策略
        .randomSeed(42)            // 固定随机种子（可选）
        .verbose(false)            // 是否输出详细信息
        .build();

// 创建GH树
GHTree ghTree = new GHTree(config);
ghTree.buildIndex(dataset, new MinkowskiDistance(2));

// 范围查询
List<MetricSpaceData> results = ghTree.rangeQuery(queryObject, radius);

// kNN查询
List<MetricSpaceData> knnResults = ghTree.knnQuery(queryObject, k);

// 获取统计信息
System.out.println(ghTree.getStatistics());
```

---

## 理论背景

### GH树 (Generalized Hyperplane Tree)

**核心思想**：使用两个支撑点(pivot)定义超平面，将空间划分为两部分。

**划分规则**：

- 对于数据点x，计算到两个pivot的距离
- 如果 d(x, p1) < d(x, p2)，则x分配到左子树
- 否则x分配到右子树

**剪枝规则**（范围查询，半径r）：

- 如果 d(q, p1) - d(q, p2) > 2r，可以剪枝左子树
- 如果 d(q, p2) - d(q, p1) > 2r，可以剪枝右子树

### VP树 (Vantage Point Tree)

**核心思想**：使用一个支撑点定义球形边界，将空间划分为内球和外球。

**划分规则**：

- 计算所有数据到pivot的距离
- 使用中位数作为划分边界
- d(x, p) <= median → 内球
- d(x, p) > median → 外球

**剪枝规则**（范围查询）：
对于子区域的距离范围 [L, U]：

- 如果 d(q, p) + r < L，可以剪枝该子树
- 如果 d(q, p) - r > U，可以剪枝该子树

### 支撑点选择策略

| 策略 | 说明 | 特点 |
|------|------|------|
| RANDOM | 随机选择 | 简单快速，但效果不稳定 |
| FFT | 最远优先遍历 | 选择距离较远的点，效果较好 |
| MAX_SPREAD | 最大分散度 | 理论最优，但计算量大 |

---

## 常见问题

### Q1: 为什么GH树在小数据集上距离计算次数反而更多？

A: 对于小数据集，树的剪枝效果不明显。GH树每个内部节点需要计算到2个pivot的距离，而VP树只需要1个。因此在小数据集或树结构不利于剪枝的情况下，GH树可能表现不如VP树。

### Q2: 如何选择合适的树配置参数？

A:

- `maxLeafSize`：通常设置为50-100，太小会导致树太深，太大会降低剪枝效果
- `minTreeHeight`：根据任务要求设置，一般3-5层即可
- `pivotStrategy`：推荐使用FFT策略，在效果和效率之间取得平衡

### Q3: 树高度为什么重要？

A: 树高度影响：

1. 查询时的节点访问次数
2. 剪枝的粒度
3. 构建时的距离计算次数

一般来说，3-5层是合适的树高。太浅则剪枝效果差，太深则节点访问开销大。

### Q4: GH树和VP树各自的优势是什么？

A:

- **GH树优势**：超平面划分对某些数据分布更有效，特别是均匀分布的数据
- **VP树优势**：每个节点只需一个pivot，构建更快；球形划分配合距离范围信息，剪枝效果通常更好

### Q5: 如何验证实现的正确性？

A: 运行TreeDemo程序，它会自动将树索引的查询结果与线性扫描结果对比，验证一致性。

---

## 单元测试

本项目使用JUnit 5作为测试框架。Assignment 3相关的测试覆盖了GH树和VP树的构建、查询、正确性和一致性验证。

### 测试类说明

| 测试类 | 说明 |
|--------|------|
| `GHTreeTest` | GH树功能测试：构建、范围查询、kNN查询、树高控制等 |
| `VPTreeTest` | VP树功能测试：构建、范围查询、kNN查询、球形划分验证等 |
| `TreeCorrectnessTest` | 正确性验证：与线性扫描结果对比 |
| `TreeConsistencyTest` | 一致性验证：GH树和VP树结果一致性 |

### 运行测试

```bash
# 运行所有测试
mvn test

# 只运行Assignment 3相关测试
mvn test "-Dtest=*Tree*"

# 运行单个测试类
mvn test "-Dtest=GHTreeTest"
mvn test "-Dtest=VPTreeTest"
mvn test "-Dtest=TreeCorrectnessTest"
mvn test "-Dtest=TreeConsistencyTest"
```

### 测试结果示例

运行 `mvn test "-Dtest=*Tree*"` 后，你会看到类似如下输出：

```
[INFO] -------------------------------------------------------
[INFO]  T E S T S
[INFO] -------------------------------------------------------
[INFO] Running index.tree.GHTreeTest

=== 测试4: 空数据集处理 ===
正确抛出异常！
测试通过！


=== 测试6: 统计信息 ===

==================================================
GH-Tree (超平面树) 统计信息
==================================================
【数据信息】
  数据集大小: 15
【树结构】
  树高度: 5
  总节点数: 13
  内部节点数: 6
  叶子节点数: 7
【构建性能】
  构建时间: 1 ms
  构建距离计算次数: 147
【查询性能（累计）】
  查询距离计算次数: 27
  节点访问次数: 13
==================================================
测试通过！


=== 测试1: GH树构建 ===
构建成功！
  树高度: 5
  总节点数: 13
  叶子节点数: 7
  构建距离计算: 147
测试通过！


=== 测试3: GH树kNN查询 ===
查询点: (5.0, 5.0)
k = 3
结果:
  #1: ID=5, 距离=1.0000
  #2: ID=3, 距离=1.4142
  #3: ID=10, 距离=2.0000
测试通过！


=== 测试2: GH树范围查询 ===
查询点: (5.0, 5.0)
查询半径: 3.0
预期结果数量: 5
实际结果数量: 5
距离计算次数: 27
测试通过！


=== 测试5: 树高度控制 ===
最小树高设置=3，实际树高=10 ✓
最小树高设置=4，实际树高=10 ✓
最小树高设置=5，实际树高=10 ✓
测试通过！

[INFO] Tests run: 6, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.073 s -- in index.tree.GHTreeTest
[INFO] Running index.tree.TreeConsistencyTest

=== 测试3: 不同Pivot策略下的结果一致性 ===
查询点: (5.0, 5.0)
范围查询半径: 2.0
kNN k值: 5
预期范围查询结果数: 21

策略              | GH范围         | VP范围         | GH-kNN       | VP-kNN
----------------------------------------------------------------------
RANDOM          | 21   ✓       | 21   ✓       | 5    ✓       | 5    ✓
FFT             | 21   ✓       | 21   ✓       | 5    ✓       | 5    ✓
MAX_SPREAD      | 21   ✓       | 21   ✓       | 5    ✓       | 5    ✓
测试通过！


=== 测试1: GH树与VP树范围查询结果一致性 ===
数据集大小: 200
GH树高度: 9
VP树高度: 4

查询#      | 半径       | GH结果     | VP结果     | 一致性
--------------------------------------------------
1        | 0.5      | 0        | 0        | ✓
2        | 1.0      | 8        | 8        | ✓
3        | 2.0      | 17       | 17       | ✓
4        | 3.0      | 32       | 32       | ✓
5        | 5.0      | 131      | 131      | ✓
6        | 0.5      | 1        | 1        | ✓
7        | 1.0      | 3        | 3        | ✓
8        | 2.0      | 8        | 8        | ✓
9        | 3.0      | 52       | 52       | ✓
10       | 5.0      | 144      | 144      | ✓
11       | 0.5      | 1        | 1        | ✓
12       | 1.0      | 4        | 4        | ✓
13       | 2.0      | 30       | 30       | ✓
14       | 3.0      | 29       | 29       | ✓
15       | 5.0      | 131      | 131      | ✓
16       | 0.5      | 2        | 2        | ✓
17       | 1.0      | 5        | 5        | ✓
18       | 2.0      | 32       | 32       | ✓
19       | 3.0      | 71       | 71       | ✓
20       | 5.0      | 54       | 54       | ✓
--------------------------------------------------
一致性: 20/20 (100.0%)
测试通过！


=== 测试2: GH树与VP树kNN查询结果一致性 ===
查询#      | k      | GH结果     | VP结果     | 一致性
--------------------------------------------------
1        | 1      | 1        | 1        | ✓
1        | 3      | 3        | 3        | ✓
1        | 5      | 5        | 5        | ✓
1        | 10     | 10       | 10       | ✓
1        | 20     | 20       | 20       | ✓
2        | 1      | 1        | 1        | ✓
2        | 3      | 3        | 3        | ✓
2        | 5      | 5        | 5        | ✓
2        | 10     | 10       | 10       | ✓
2        | 20     | 20       | 20       | ✓
3        | 1      | 1        | 1        | ✓
3        | 3      | 3        | 3        | ✓
3        | 5      | 5        | 5        | ✓
3        | 10     | 10       | 10       | ✓
3        | 20     | 20       | 20       | ✓
...
--------------------------------------------------
一致性: 75/75 (100.0%)
测试通过！


=== 测试4: 大规模数据一致性测试 ===
数据集大小: 1000
GH树: 高度=9, 节点数=71, 构建时间=1ms
VP树: 高度=5, 节点数=63, 构建时间=3ms

范围查询一致性: 50/50 (100.0%)
kNN查询一致性: 50/50 (100.0%)
测试通过！

[INFO] Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.061 s -- in index.tree.TreeConsistencyTest
[INFO] Running index.tree.TreeCorrectnessTest

=== 测试4: 蛋白质序列数据正确性 ===
数据集大小: 50
序列长度: 6
GH树高: 5
VP树高: 3
所有蛋白质序列查询测试通过！


=== 测试2: 高维向量(10D)范围查询正确性 ===
数据集大小: 200
数据维度: 10
所有高维向量查询测试通过！


=== 测试3: kNN查询正确性 ===
数据集大小: 100
所有kNN查询测试通过！


=== 测试5: 边界情况测试 ===
测试半径=0的查询...
  GH树: 1个结果 ✓
  VP树: 1个结果 ✓
测试很大半径的查询...
  GH树: 50个结果 ✓
  VP树: 50个结果 ✓
测试k=1的kNN查询...
  GH树: ID=0 ✓
  VP树: ID=0 ✓
测试通过！


=== 测试1: 2D向量范围查询正确性 ===
数据集大小: 100
测试查询数: 10
通过率: 40/40 (100.0%)
测试通过！

[INFO] Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.030 s -- in index.tree.TreeCorrectnessTest
[INFO] Running index.tree.VPTreeTest

=== 测试5: 不同半径的范围查询 ===
查询点: (5.0, 5.0)
半径         | 结果数        | 距离计算
----------------------------------------
1.0        | 1          | 12
2.0        | 3          | 12
3.0        | 5          | 15
5.0        | 13         | 15
10.0       | 15         | 15
测试通过！


=== 测试6: 统计信息 ===

==================================================
VP-Tree (优势点树) 统计信息
==================================================
【数据信息】
  数据集大小: 15
【树结构】
  树高度: 2
  总节点数: 7
  内部节点数: 3
  叶子节点数: 4
【构建性能】
  构建时间: 0 ms
  构建距离计算次数: 55
【查询性能（累计）】
  查询距离计算次数: 0
  节点访问次数: 0
==================================================
测试通过！


=== 测试1: VP树构建 ===
构建成功！
  树高度: 2
  总节点数: 7
  叶子节点数: 4
  构建距离计算: 55
测试通过！


=== 测试4: 球形划分验证 ===

============================================================
开始构建 VP-Tree (优势点树)
============================================================
数据集大小: 15
配置: TreeConfig[maxLeafSize=5, minTreeHeight=2, pivotStrategy=FFT, verbose=true, seed=42]
  深度0: 选择支撑点 VectorData[id=0, dim=2, coords=[1.0000, 1.0000]]
  深度0: 数据划分完成，内球=7[1.4142, 6.0828]，外球=7[6.3246, 10.8167]，中位数=6.2037
  深度1: 选择支撑点 VectorData[id=11, dim=2, coords=[6.0000, 1.0000]]
  深度1: 数据划分完成，内球=3[1.4142, 3.6056]，外球=3[4.1231, 7.2111]，中位数=3.8643
  深度2: 创建叶子节点，数据量=3
  深度2: 创建叶子节点，数据量=3
  深度1: 选择支撑点 VectorData[id=14, dim=2, coords=[4.0000, 8.0000]]
  深度1: 数据划分完成，内球=3[3.6056, 5.8310]，外球=3[6.0828, 7.2111]，中位数=5.9569
  深度2: 创建叶子节点，数据量=3
  深度2: 创建叶子节点，数据量=3

构建完成!
----------------------------------------
构建耗时: 1 ms
树高度: 2
总节点数: 7
  - 内部节点: 3
  - 叶子节点: 4
构建距离计算次数: 55
============================================================

VP树结构:

VP-Tree (优势点树) 树结构:
--------------------------------------------------
└── VP内部节点 [内=7, 外=7, median=6.204, pivot=ID0]
    ├── VP内部节点 [内=3, 外=3, median=3.864, pivot=ID11]
    │   ├── 叶子节点 [数据量=3]
    │   └── 叶子节点 [数据量=3]
    └── VP内部节点 [内=3, 外=3, median=5.957, pivot=ID14]
        ├── 叶子节点 [数据量=3]
        └── 叶子节点 [数据量=3]
--------------------------------------------------
测试通过！


=== 测试3: VP树kNN查询 ===
查询点: (5.0, 5.0)
k = 3
结果:
  #1: ID=5, 距离=1.0000
  #2: ID=3, 距离=1.4142
  #3: ID=10, 距离=2.0000
测试通过！


=== 测试2: VP树范围查询 ===
查询点: (5.0, 5.0)
查询半径: 3.0
预期结果数量: 5
实际结果数量: 5
距离计算次数: 15
测试通过！

[INFO] Tests run: 6, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.021 s -- in index.tree.VPTreeTest
[INFO] 
[INFO] Results:
[INFO]
[INFO] Tests run: 21, Failures: 0, Errors: 0, Skipped: 0
[INFO]
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time:  1.701 s
[INFO] Finished at: 2025-12-11T00:40:57+08:00
[INFO] ------------------------------------------------------------------------
```

### 测试覆盖的场景

#### GHTreeTest (6个测试)

1. **测试1: GH树构建** - 验证树能正确构建，高度满足最小要求
2. **测试2: GH树范围查询** - 验证范围查询结果正确
3. **测试3: GH树kNN查询** - 验证kNN查询结果正确
4. **测试4: 空数据集处理** - 验证对空数据集抛出适当异常
5. **测试5: 树高度控制** - 验证不同minTreeHeight设置下树高正确
6. **测试6: 统计信息** - 验证统计信息输出完整

#### VPTreeTest (6个测试)

1. **测试1: VP树构建** - 验证树能正确构建，数据总量正确
2. **测试2: VP树范围查询** - 验证范围查询结果正确
3. **测试3: VP树kNN查询** - 验证kNN查询结果正确
4. **测试4: 球形划分验证** - 展示并验证球形划分的结构
5. **测试5: 不同半径的范围查询** - 验证不同半径下结果正确
6. **测试6: 统计信息** - 验证统计信息输出完整

#### TreeCorrectnessTest (5个测试)

1. **测试1: 2D向量范围查询正确性** - 与线性扫描对比，验证100%正确
2. **测试2: 高维向量(10D)范围查询正确性** - 高维数据正确性验证
3. **测试3: kNN查询正确性** - kNN结果与线性扫描对比
4. **测试4: 蛋白质序列数据正确性** - 非向量数据类型测试
5. **测试5: 边界情况测试** - 半径0、大半径、k=1等边界情况

#### TreeConsistencyTest (4个测试)

1. **测试1: 范围查询结果一致性** - GH树和VP树范围查询结果一致
2. **测试2: kNN查询结果一致性** - GH树和VP树kNN结果一致
3. **测试3: 不同Pivot策略的一致性** - RANDOM/FFT/MAX_SPREAD策略结果一致
4. **测试4: 大规模数据一致性** - 1000数据点下的一致性验证

### 完整测试结果

运行 `mvn test` 后的完整结果：

```
[INFO] Tests run: 38, Failures: 0, Errors: 0, Skipped: 0
[INFO] BUILD SUCCESS
```

所有38个测试全部通过，包括：

- 4个树索引相关测试类（21个测试）
- 原有的数据类型和查询测试（17个测试）

---

## 运行命令汇总

```bash
# 编译项目
mvn clean compile

# 运行功能演示
mvn exec:java "-Dexec.mainClass=examples.assignment3.TreeDemo"

# 运行性能分析
mvn exec:java "-Dexec.mainClass=examples.assignment3.TreePerformanceAnalysis"

# 运行所有测试
mvn test

# 只运行Assignment 3相关测试
mvn test "-Dtest=*Tree*"

# 运行单个测试类
mvn test "-Dtest=GHTreeTest"
mvn test "-Dtest=TreeCorrectnessTest"
```

---

## 相关文档

- [Assignment 3 需求文档](../Assignment3/Assignment3-Requirements.md)
- [项目整体架构规划](../tasks/Assignment3/00-项目整体架构规划.md)
- [详细任务分解](../tasks/Assignment3/01-Assignment3-详细任务分解.md)
- [理论基础整理](../tasks/Assignment3/02-理论基础整理.md)

---

## 版本信息

- **版本**: 1.0
- **更新日期**: 2025-12-10
- **作者**: Jixiang Ding
